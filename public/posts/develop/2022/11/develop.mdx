---
title: 리액트에서 비동기로직 처리와 데이터 관리
category: develop
published: 2022-11-6
keywords: Presigned URL,url
description: useQuery-비동기 요청 처리와 상태관리
---

# 테스트

프론트엔드의 꽃은 비동기 요청 처리와 상태관리가 아닌가 생각한다.나는 리액트에서 비동기로직 처리와 데이터 관리를 어려워하고 이에 대한 고민을 많이 하곤했다.

`Presigned URL`은 미리 서명된 권한으로 잠시 접근가능하게 해주는 임시 url을 발급해주는 것이다. 파일에 접근하고 업로드(GET, POST)등 HTTP메소드를 사용할 수 있고 발급된 url의 만료기간을 설정할 수 있다.

---

## 파일 업로드 절차

1. 클라이언트에서 서버로 presigned url을 요청한다.
2. 서버에서 S3로 권한을 요청하고 클라이언트에 응답해준다.
3. 클라이언트에서 S3버킷으로 업로드한다.
   나는 Next js와 프리즈마 orm을 사용중이기 때문에 프리즈마 블로그에서 찾은 ‘Next js + prisma + typescript 이미지 업로드’부분을 참고했다! 여기서 나온 방식은 Presigned-POST방식이다.

Presigned POST방식은 Presigned URL하고는 약간 다른데 POST메서드만 사용할 수 있어서 업로드만 가능하다는 점이 다르다. 구현과정에서 우여곡절이 많았지만 업로드 성공한 코드를 올려본다.

```js
for (const post of posts) {
  const filePath = path.join(process.cwd(), rootDirectory, post);
  if (!filePath) continue;
  try {
    const fileContent = fs.readFileSync(filePath, 'utf8');
    const mdxSource = await bundleMDX({ source: fileContent });
    files.push(mdxSource);
  } catch (err) {
    // console.log(err);
  }
}
```

Suspendisse felis diam, ullamcorper sit amet massa non, varius dictum dui. In et euismod odio. Morbi tristique lacus neque. Donec pulvinar lorem nisl, non tempus mi ultricies id. Quisque et nisi aliquam, viverra sapien pretium, pharetra lorem. Donec at sapien interdum, tempor est quis, imperdiet orci. Curabitur bibendum libero in nulla egestas pellentesque. Ut ipsum felis, maximus ut risus eu, aliquet elementum urna. Pellentesque at velit enim.

Maecenas gravida ex eu quam dictum, eu tristique arcu fermentum. Fusce non est elit. Nulla lectus risus, rhoncus vitae convallis sit amet, vulputate ut est. Curabitur feugiat justo ut lacinia volutpat. Donec fringilla porta lacus, id aliquet tellus pulvinar in. Mauris aliquam ut urna eget fermentum. Vivamus a sagittis erat. Vivamus interdum ipsum vel mauris maximus varius. Curabitur et nibh nisl. Nullam non tortor nisi. Vestibulum et purus ac felis convallis convallis sit amet eu ligula. Fusce vitae enim erat. Praesent posuere, dui eget pretium bibendum, lorem lorem volutpat purus, et egestas ante nulla nec ex. In gravida tortor eu erat hendrerit, a sodales tellus facilisis. Aenean porta felis vel orci eleifend, sit amet rutrum velit rutrum. Praesent feugiat, magna eget commodo aliquet, lectus augue eleifend nunc, dictum ultrices justo eros aliquam ante.

Aliquam et tellus ex. Nulla in molestie massa. Nunc vel dui magna. Curabitur at ligula finibus, hendrerit tortor et, efficitur ipsum. Curabitur cursus molestie mauris, vel pulvinar dolor aliquet ac. Ut ligula ligula, iaculis at commodo sit amet, ornare in ante. Ut efficitur lorem vitae dapibus ornare. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce nibh quam, convallis sit amet semper nec, tincidunt sit amet turpis. Aliquam erat volutpat. Nullam a cursus nunc.

Fusce hendrerit urna non turpis commodo semper. Aliquam commodo elit et nibh interdum, in tincidunt nibh pharetra. Praesent bibendum ultricies nibh, id pellentesque erat tempor sit amet. Sed sagittis vel velit eu fringilla. Suspendisse dignissim tempor eros ut venenatis. Proin et est sapien. Phasellus eget dui dignissim, hendrerit justo ut, viverra erat. Proin porttitor interdum ultrices.

Nunc at dapibus augue. Donec feugiat mattis nisl non lacinia. Vivamus scelerisque aliquet accumsan. Donec pellentesque laoreet posuere. Praesent finibus non mauris sit amet scelerisque. Nunc egestas dolor quis felis pharetra facilisis. Morbi pharetra eros massa, sit amet pellentesque est faucibus vitae. Donec et metus non nisi imperdiet feugiat. Nunc ut lacus gravida, consequat lacus vel, finibus risus. Praesent porttitor, tortor vestibulum consequat tincidunt, dolor odio luctus nulla, nec rhoncus nulla arcu sodales odio. Fusce vestibulum purus eget magna molestie, nec ultricies arcu pretium. Integer pretium odio turpis, nec faucibus ligula egestas id. Pellentesque sed lacus nec sapien facilisis hendrerit. Suspendisse scelerisque feugiat tempus.

Pellentesque eu ex molestie, efficitur turpis id, porttitor urna. Fusce vitae lacus non neque feugiat ultrices. Aliquam ut sapien non lacus ornare viverra non et ante. Sed nibh velit, pharetra non elit ut, varius suscipit dui. In faucibus sit amet ipsum et dapibus. Fusce maximus sem vitae dui cursus, vitae ultrices urna laoreet. Aenean nisi mi, malesuada vel sagittis quis, laoreet id neque.

Pellentesque tincidunt quis quam sed eleifend. Quisque at ipsum et neque cursus dignissim. Sed ante tellus, vehicula id venenatis luctus, sagittis ut leo. Sed eu velit et risus auctor fermentum ut id mi. Curabitur purus ante, elementum eu consequat sit amet, efficitur lobortis elit. Nullam cursus fringilla sodales. Nam vehicula pharetra ante vel ultricies.

Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Phasellus lorem ex, rutrum et neque a, pellentesque pulvinar erat. Curabitur hendrerit tempus dapibus. Etiam lacus tellus, malesuada et quam at, maximus faucibus leo. Sed turpis nisi, euismod vel efficitur quis, auctor et sapien. Aliquam sit amet dui in metus ornare consequat. Praesent luctus nisi ut urna tempor, sed hendrerit quam interdum. Etiam fermentum ipsum eu erat laoreet dictum. Fusce malesuada volutpat vehicula. Nulla metus nulla, facilisis et mi ac, eleifend dignissim ex.
